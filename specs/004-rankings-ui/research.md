# Research Findings: 小程序端排行榜界面

**Feature**: `004-rankings-ui` | **Date**: 2026-01-16
**Input**: Technical unknowns from implementation plan

## 研究问题与决策

### RQ1: 热度算法时间权重计算方式

**Context**: 热度分数 = (使用次数 × 1 + 点赞数 × 3) × 时间权重

**Research Question**: 如何计算时间权重？近期数据应该获得更高权重，但需要平衡数据的新鲜度和稳定性。

**Decision**: 采用指数衰减模型
**Rationale**: 指数衰减能够很好地反映内容的新鲜度，同时避免权重变化过于剧烈。相比线性衰减，指数衰减更符合用户对热门内容的认知（新内容更容易成为热门）。

**Alternatives Considered**:
- 线性衰减：权重 = 1 / (1 + 天数) - 实现简单但衰减过于平缓
- 分段衰减：最近7天权重1.0，8-30天权重0.5，30天后权重0.1 - 过于复杂，维护困难

**Implementation**: 权重 = e^(-0.1 × 天数)，其中天数为距离当前的天数。这样1天前权重约0.905，7天前权重约0.497，30天前权重约0.049。

---

### RQ2: 小程序端数据缓存最佳实践

**Context**: 需要缓存排行榜数据以提升用户体验和减少服务器压力

**Research Question**: 在小程序环境中，如何实现有效的排行榜数据缓存？需要考虑缓存时效性、存储限制和更新策略。

**Decision**: 采用小程序本地存储 + 智能更新策略
**Rationale**: 小程序本地存储可以提供快速的数据访问，智能更新策略能够在保证数据新鲜度的同时减少网络请求。

**Alternatives Considered**:
- 不缓存：每次进入页面都重新加载 - 用户体验差，增加服务器压力
- 仅缓存到内存：页面刷新后丢失 - 无法应对小程序生命周期

**Implementation**:
- 缓存结构：{ data: rankingsData, timestamp: updateTime, ttl: 3600000 } (1小时TTL)
- 更新策略：页面加载时检查缓存，如果存在且未过期直接使用，否则从服务器获取
- 手动刷新：提供"刷新"按钮允许用户主动更新数据

---

### RQ3: 云对象API设计模式

**Context**: 需要设计排行榜数据的获取API

**Research Question**: 如何设计云对象API来支持三种排行榜类型的数据获取，同时保证性能和可扩展性？

**Decision**: 采用统一API接口 + 参数化查询
**Rationale**: 统一接口简化客户端调用，参数化查询提供灵活性，同时可以利用云数据库的索引优化性能。

**Alternatives Considered**:
- 三个独立API：getUsageRankings, getLikesRankings, getHotRankings - 接口冗余，维护困难
- 单一API返回所有数据：客户端过滤 - 增加网络传输量和客户端计算负担

**Implementation**:
- API接口：getRankings(type, limit = 20)
- 参数说明：
  - type: 'usage' | 'likes' | 'hot'
  - limit: 返回数量，默认20
- 返回格式：{ success: true, data: [{ rank, scriptId, title, author, value, ... }] }

---

### RQ4: 排名显示的视觉设计

**Context**: 前三名使用奖牌图标，其他使用数字排名

**Research Question**: 如何在小程序中实现奖牌图标和数字排名的混合显示，保证视觉一致性和可读性？

**Decision**: 使用Unicode字符 + CSS样式优化
**Rationale**: Unicode字符轻量无额外资源依赖，CSS样式可以保证视觉一致性。

**Alternatives Considered**:
- 图片资源：需要下载和缓存，增加包体积
- 纯文字：缺乏视觉吸引力

**Implementation**:
- 🥇🥈🥉 用于前三名
- 数字排名使用圆形背景的数字
- 所有排名元素使用统一的字体大小和颜色方案

## 技术约束验证

### 性能约束
- 数据加载：<2秒 - 通过缓存和云对象优化实现
- 页面切换：<1秒 - 使用uni-app的页面缓存机制

### 小程序环境约束
- 存储限制：本地缓存不超过小程序限制
- 网络请求：合理使用缓存减少请求频率
- UI组件：使用uni-app内置组件保证兼容性

## 风险评估

### 高风险项
1. **热度算法准确性** - 如果算法过于复杂可能影响性能
   - 缓解：先实现简单版本，观察效果后再优化

2. **缓存一致性** - 本地缓存可能与服务器数据不一致
   - 缓解：设置合理的TTL和手动刷新机制

### 中风险项
1. **小程序审核** - 新页面可能需要审核
   - 缓解：遵循小程序开发规范，使用标准组件

2. **数据量增长** - 随着剧本数量增加，排行榜计算可能变慢
   - 缓解：使用数据库索引优化查询性能

## 结论

所有关键技术问题已研究并做出决策。热度算法采用指数衰减，数据缓存使用本地存储+智能更新，API设计采用统一接口模式，UI显示使用Unicode字符+CSS样式。这些决策平衡了功能需求、性能要求和实现复杂度。