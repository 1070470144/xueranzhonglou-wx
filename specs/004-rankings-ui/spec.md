# Feature Specification: 小程序端排行榜界面（使用排行、点赞排行榜、热度排行榜）

**Feature Branch**: `004-rankings-ui`
**Created**: 2026-01-16
**Status**: Draft
**Input**: User description: "完善小程序端，排行榜界面，三个排行：使用排行，点赞排行榜，热度排行榜。"

**文档语言**: 本规范与其衍生文档须使用中文编写。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 查看使用排行榜（Priority: P1）

普通玩家在小程序中想要查看剧本使用排行榜，了解哪些剧本最受欢迎、最常被使用。

**Why this priority**: 提供数据驱动的剧本发现机制，帮助用户找到高质量内容。

**Independent Test**: 在小程序排行榜页面切换到"使用排行"选项卡，验证显示剧本列表按使用次数降序排列，显示前20个剧本。

**Acceptance Scenarios**:
1. Given 用户在小程序排行榜页面，When 点击"使用排行"选项卡，Then 系统显示按使用次数降序排列的剧本列表。
2. Given 剧本列表，When 用户查看列表项，Then 每个剧本显示名称、作者、使用次数排名。
3. Given 排行榜数据，When 排名有并列情况，Then 系统使用合理的排序规则（如按剧本ID排序）确保排名稳定。

---

### User Story 2 - 查看点赞排行榜（Priority: P2）

普通玩家在小程序中想要查看剧本点赞排行榜，了解哪些剧本获得最多用户认可。

**Why this priority**: 让用户能够根据社区认可度发现优质剧本。

**Independent Test**: 在小程序排行榜页面切换到"点赞排行榜"选项卡，验证显示剧本列表按点赞数降序排列，显示前20个剧本。

**Acceptance Scenarios**:
1. Given 用户在小程序排行榜页面，When 点击"点赞排行榜"选项卡，Then 系统显示按点赞数降序排列的剧本列表。
2. Given 剧本列表，When 用户查看列表项，Then 每个剧本显示名称、作者、点赞数和排名。
3. Given 点赞数据变化，When 排行榜刷新，Then 显示最新的点赞数据。

---

### User Story 3 - 查看热度排行榜（Priority: P3）

普通玩家在小程序中想要查看剧本热度排行榜，了解当前最热门的剧本。

**Why this priority**: 帮助用户及时发现新兴热门内容。

**Independent Test**: 在小程序排行榜页面切换到"热度排行榜"选项卡，验证显示剧本列表按热度算法降序排列，显示前20个剧本。

**Acceptance Scenarios**:
1. Given 用户在小程序排行榜页面，When 点击"热度排行榜"选项卡，Then 系统显示按热度算法降序排列的剧本列表。
2. Given 剧本列表，When 用户查看列表项，Then 每个剧本显示名称、作者、热度分数和排名。

---

### Edge Cases

- 排行榜数据为空：系统应显示友好的空状态提示，说明暂无排行数据。
- 数据加载失败：系统应显示错误提示，并提供重试机制。
- 排行榜数据量过少：当有效剧本少于20个时，显示所有可用剧本。
- 网络不稳定：系统应有合理的缓存机制，在离线时显示最后缓存的数据。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 在小程序中新增排行榜页面，支持用户浏览三个不同类型的排行榜（使用排行、点赞排行榜、热度排行榜）。
- **FR-002**: 系统 MUST 支持选项卡切换，让用户可以在三个排行榜之间轻松切换。
- **FR-003**: 对于使用排行，系统 MUST 按剧本的使用次数降序排列，显示前20个剧本。
- **FR-004**: 对于点赞排行榜，系统 MUST 按剧本的点赞数降序排列，显示前20个剧本。
- **FR-005**: 对于热度排行榜，系统 MUST 使用合理的热度算法（如使用次数+点赞数×权重）降序排列，显示前20个剧本。
- **FR-006**: 每个排行榜项 MUST 显示剧本名称、作者、对应指标数值（使用次数/点赞数/热度分数）和排名。
- **FR-007**: 系统 MUST 支持点击排行榜项跳转到剧本详情页面。
- **FR-008**: 系统 MUST 定期刷新排行榜数据，确保显示最新的统计信息。
- **FR-009**: 系统 MUST 在排行榜页面显示最后更新时间，让用户了解数据的时效性。

### Key Entities

- **ScriptRanking**: 表示排行榜数据。属性（示例）: scriptId, title, author, usageCount, likes, hotScore, rankingType, rank, lastUpdated。
- **RankingType**: 枚举类型，包含：USAGE（使用排行）、LIKES（点赞排行）、HOT（热度排行）。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户在小程序中能够顺利访问排行榜页面，并在3秒内完成排行榜类型的切换。
- **SC-002**: 排行榜数据在95%的情况下能够在2秒内加载完成并正确显示。
- **SC-003**: 三个排行榜的数据准确性达到100%，排名计算正确无误。
- **SC-004**: 用户能够从排行榜页面成功跳转到剧本详情页面，跳转成功率达到99%。
- **SC-005**: 系统在高峰期（每日活跃用户超过1000人）时仍能正常提供排行榜服务。

## Assumptions

- 排行榜数据基于现有剧本数据的统计（使用次数、点赞数）。
- 热度算法采用时间衰减公式：热度分数 = (使用次数 × 1 + 点赞数 × 3) × 时间权重，近期数据权重更高。
- 排行榜显示前20个剧本，如果总剧本数少于20个则显示全部。
- 系统每日自动刷新排行榜数据。
- 排行榜页面集成到现有小程序导航结构中。
- 排名显示采用混合格式：前三名使用奖牌图标（🥇🥈🥉），其他名次使用数字排名。

## Clarifications Resolved

1. ✅ Q1 - 热度算法：采用时间衰减公式，热度 = (使用次数 × 1 + 点赞数 × 3) × 时间权重
2. ✅ Q2 - 刷新频率：每日自动刷新排行榜数据
3. ✅ Q3 - 排名显示：混合格式，前三名使用奖牌图标，其他使用数字排名

## Test Scenarios (manual)

1. 基础排行榜浏览：打开小程序排行榜页面 → 切换不同排行榜选项卡 → 验证数据正确加载和排序 → 点击剧本项验证跳转。
2. 数据准确性验证：准备测试数据 → 验证三个排行榜的排序和数值显示正确 → 检查排名并列情况的处理。
3. 性能测试：模拟高并发访问 → 验证页面加载速度和数据刷新性能 → 测试网络不稳定情况下的表现。
4. 边界情况测试：测试数据为空时的情况 → 测试只有少量剧本时的排行榜显示 → 测试网络错误时的错误处理。

## Readiness

✅ 所有Clarification问题已解决，规范已准备好进入计划阶段（/speckit.plan）。

---

**Spec author**: automated assistant