# 修复热度榜单零值问题 - 需求清单

## 功能需求

### 核心需求
- [x] **热度数值显示修复**: 修复热度榜单数值始终显示为0的问题
- [x] **最小热度保证**: 为零值剧本提供最小热度值显示
- [x] **时间衰减优化**: 调整时间衰减系数，使热度衰减更加合理

### 技术需求
- [x] **云函数修改**: 修改getRankings云函数的热度计算逻辑
- [x] **数据库兼容**: 确保修改不影响现有数据结构和查询性能
- [x] **前端兼容**: 前端无需修改，数值格式化逻辑保持不变
- [x] **调试支持**: 提供调试模式以便排查问题

## 非功能需求

### 性能需求
- [x] **响应时间**: API响应时间保持在2秒以内
- [x] **查询效率**: 数据库聚合查询性能无明显下降
- [x] **缓存机制**: 前端缓存机制继续有效

### 可靠性需求
- [x] **错误处理**: 完善的错误处理和降级机制
- [x] **数据验证**: 输入参数和输出数据的完整验证
- [x] **日志记录**: 关键操作的日志记录便于问题排查

### 可维护性需求
- [x] **代码注释**: 清晰的代码注释说明修改逻辑
- [x] **文档更新**: API文档和快速开始指南更新
- [x] **测试覆盖**: 提供测试步骤和验收标准

## 验收标准

### 功能验收标准
- [ ] 热度排行榜页面可以正常加载
- [ ] 热度数值不再显示为0
- [ ] 零值剧本显示最小热度0.1
- [ ] 数值格式正确显示一位小数
- [ ] 排行榜排序逻辑正确

### 质量验收标准
- [ ] 代码无linter错误
- [ ] 云函数可以正常部署
- [ ] API响应格式符合规范
- [ ] 调试模式输出正确信息
- [ ] 无控制台错误日志

### 用户验收标准
- [ ] 用户可以看到剧本的热度信息
- [ ] 热度数值反映剧本的真实热度
- [ ] 界面显示流畅，无卡顿现象
- [ ] 不同设备上显示一致

## 测试场景

### 正向测试场景
- [ ] 活跃剧本热度正常显示
- [ ] 零值剧本显示最小热度
- [ ] 不同更新时间的剧本热度计算正确
- [ ] 大量数据下的性能表现

### 异常测试场景
- [ ] 数据库连接失败时的降级处理
- [ ] 无效参数的错误提示
- [ ] 网络超时情况下的用户体验
- [ ] 缓存失效后的数据加载

### 边界测试场景
- [ ] 单个剧本的热度计算
- [ ] 极限数量（50个）剧本的显示
- [ ] 极旧剧本（数月前）的热度衰减
- [ ] 极新剧本（刚刚创建）的热度表现

## 依赖关系

### 前置条件
- [x] 数据库中存在活跃状态的剧本数据
- [x] 云函数运行环境正常
- [x] 小程序前端代码完整

### 后置依赖
- [ ] 前端缓存清理（部署后）
- [ ] 用户通知（问题修复完成）
- [ ] 监控指标建立（长期跟踪）

## 风险评估

### 技术风险
- **高风险**: 聚合管道修改可能导致性能问题
  - **规避措施**: 在测试环境充分验证
  - **应急方案**: 保留原代码版本快速回滚

- **中风险**: 最小热度保证影响排序公平性
  - **规避措施**: 所有零值剧本使用相同最小值
  - **应急方案**: 可调整最小热度值

### 业务风险
- **中风险**: 用户可能对"最小热度"概念困惑
  - **规避措施**: 在界面说明中解释热度计算逻辑
  - **应急方案**: 调整最小热度值为更小的数值

## 发布要求

### 部署前检查
- [ ] 云函数代码已上传到uniCloud
- [ ] 测试环境验证通过
- [ ] 数据库备份完成
- [ ] 回滚方案准备就绪

### 部署后验证
- [ ] 小程序端功能正常
- [ ] 热度数值正确显示
- [ ] 无错误日志产生
- [ ] 性能指标正常

### 监控指标
- [ ] API调用成功率 > 99%
- [ ] 平均响应时间 < 2秒
- [ ] 用户反馈问题解决率 100%