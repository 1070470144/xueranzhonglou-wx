openapi: 3.0.3
info:
  title: æ’è¡Œæ¦œAPI
  description: å°ç¨‹åºæ’è¡Œæ¦œæ•°æ®è·å–API
  version: 1.1.0
  contact:
    name: å¼€å‘å›¢é˜Ÿ

servers:
  - url: https://unicloud.dcloud.net.cn
    description: uniCloudäº‘å‡½æ•°ç¯å¢ƒ

paths:
  /getRankings:
    post:
      summary: è·å–æ’è¡Œæ¦œæ•°æ®
      description: è·å–æŒ‡å®šç±»å‹çš„æ’è¡Œæ¦œæ•°æ®ï¼Œæ”¯æŒä½¿ç”¨æ’è¡Œã€ç‚¹èµæ’è¡Œå’Œçƒ­åº¦æ’è¡Œ
      operationId: getRankings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
              properties:
                type:
                  type: string
                  enum: [usage, likes, hot]
                  description: æ’è¡Œæ¦œç±»å‹
                  example: hot
                limit:
                  type: integer
                  minimum: 1
                  maximum: 50
                  default: 20
                  description: è¿”å›æ•°é‡é™åˆ¶
                debug:
                  type: boolean
                  default: false
                  description: è°ƒè¯•æ¨¡å¼ï¼Œè¾“å‡ºè¯¦ç»†è®¡ç®—ä¿¡æ¯
      responses:
        '200':
          description: æˆåŠŸè·å–æ’è¡Œæ¦œæ•°æ®
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - data
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      required:
                        - rank
                        - scriptId
                        - title
                        - author
                        - value
                      properties:
                        rank:
                          type: integer
                          description: æ’å
                          example: 1
                        scriptId:
                          type: string
                          description: å‰§æœ¬ID
                          example: "507f1f77bcf86cd799439011"
                        title:
                          type: string
                          description: å‰§æœ¬æ ‡é¢˜
                          example: "ç»å…¸ç‹¼äººæ€å‰§æœ¬"
                        author:
                          type: string
                          description: ä½œè€…å§“å
                          example: "å®˜æ–¹å‡ºå“"
                        value:
                          type: number
                          description: æ’è¡Œæ¦œæ•°å€¼
                          example: 125.5
                        medal:
                          type: string
                          enum: ["ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰"]
                          description: å¥–ç‰Œï¼ˆå‰ä¸‰åï¼‰
                        _debug:
                          type: object
                          description: è°ƒè¯•ä¿¡æ¯ï¼ˆä»…åœ¨debug=trueæ—¶è¿”å›ï¼‰
                          properties:
                            usageCount:
                              type: integer
                              example: 1250
                            likes:
                              type: integer
                              example: 156
                            updateTimeOrDefault:
                              type: string
                              format: date-time
                            daysSinceUpdate:
                              type: number
                              example: 2.5
                            timeWeight:
                              type: number
                              example: 0.8
                            baseScore:
                              type: number
                              example: 546
                            hotScore:
                              type: number
                              example: 436.8
                  totalCount:
                    type: integer
                    description: æ€»è®°å½•æ•°
                    example: 20
                  lastUpdated:
                    type: string
                    format: date-time
                    description: æœ€åæ›´æ–°æ—¶é—´
                    example: "2024-01-16T10:30:00.000Z"
        '400':
          description: å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - message
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "æ— æ•ˆçš„æ’è¡Œæ¦œç±»å‹"
        '500':
          description: æœåŠ¡å™¨é”™è¯¯
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - message
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "è·å–æ’è¡Œæ¦œå¤±è´¥: æ•°æ®åº“è¿æ¥é”™è¯¯"

components:
  schemas:
    RankingItem:
      type: object
      required:
        - rank
        - scriptId
        - title
        - author
        - value
      properties:
        rank:
          type: integer
          description: æ’åï¼ˆä»1å¼€å§‹ï¼‰
        scriptId:
          type: string
          description: å‰§æœ¬å”¯ä¸€æ ‡è¯†
        title:
          type: string
          description: å‰§æœ¬æ ‡é¢˜
        author:
          type: string
          description: ä½œè€…å§“å
        value:
          type: number
          description: æ’è¡Œæ¦œæ•°å€¼ï¼ˆä½¿ç”¨æ¬¡æ•°/ç‚¹èµæ•°/çƒ­åº¦å€¼ï¼‰
        medal:
          type: string
          enum: ["ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰"]
          description: æ’åå¥–ç‰Œï¼ˆä»…å‰ä¸‰åï¼‰
        _debug:
          type: object
          description: è°ƒè¯•ä¿¡æ¯
          properties:
            usageCount:
              type: integer
              description: ä½¿ç”¨æ¬¡æ•°
            likes:
              type: integer
              description: ç‚¹èµæ•°
            updateTimeOrDefault:
              type: string
              format: date-time
              description: æ›´æ–°æ—¶é—´
            daysSinceUpdate:
              type: number
              description: è·ä»Šå¤©æ•°
            timeWeight:
              type: number
              description: æ—¶é—´æƒé‡
            baseScore:
              type: number
              description: åŸºç¡€åˆ†æ•°
            hotScore:
              type: number
              description: æœ€ç»ˆçƒ­åº¦åˆ†æ•°

  parameters:
    RankingType:
      name: type
      in: query
      required: true
      schema:
        type: string
        enum: [usage, likes, hot]
      description: æ’è¡Œæ¦œç±»å‹

  responses:
    RankingsResponse:
      description: æ’è¡Œæ¦œæ•°æ®å“åº”
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
              data:
                type: array
                items:
                  $ref: '#/components/schemas/RankingItem'
              totalCount:
                type: integer
              lastUpdated:
                type: string
                format: date-time

    ErrorResponse:
      description: é”™è¯¯å“åº”
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: "è·å–æ’è¡Œæ¦œå¤±è´¥"