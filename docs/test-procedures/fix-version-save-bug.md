# 修复版本号保存bug - 测试流程

**测试目标**: 验证管理端编辑剧本时版本号字段的保存功能是否正常工作

**修复内容**:
1. 在edit.vue的saveScript方法中添加version字段传递
2. 在数据库schema中添加version字段定义
3. 在云函数中添加version字段验证

## 测试环境准备

### 步骤1: 数据库schema更新
确保数据库schema已更新，包含version字段定义

### 步骤2: 云函数部署
确保scriptManager云函数已部署最新版本

### 步骤3: 测试数据准备
1. 在管理端创建或选择一个现有剧本
2. 记录当前版本号（例如：1.0）

## 测试流程

### 测试用例 1: 版本号字段传递验证

**目的**: 验证前端编辑页面能正确传递version字段给后端

**步骤**:
1. 进入管理端剧本编辑页面
2. 修改版本号字段（例如从1.0改为2.0）
3. 点击保存按钮
4. 检查浏览器开发者工具的网络请求

**验证点**:
- ✅ 请求payload包含version字段且值为修改后的值
- ✅ API响应成功（code: 0）

### 测试用例 2: 数据库字段更新验证

**目的**: 验证数据库中version字段能正确更新

**步骤**:
1. 在管理端修改版本号并保存
2. 使用数据库查询工具检查该剧本记录
3. 查看version字段值是否已更新

**验证点**:
- ✅ 数据库中version字段值与前端修改一致
- ✅ updateTime字段也被正确更新

### 测试用例 3: 版本号显示验证

**目的**: 验证修改后的版本号能正确显示

**步骤**:
1. 修改版本号并保存成功
2. 刷新编辑页面
3. 检查版本号字段是否显示修改后的值

**验证点**:
- ✅ 编辑页面重新加载后显示正确的版本号
- ✅ 列表页面（如有版本号显示）也显示正确值

### 测试用例 4: 数据验证测试

**目的**: 验证版本号字段的格式验证是否正常

**步骤**:
1. 尝试输入超长版本号（超过20字符）
2. 尝试输入其他数据类型
3. 检查验证错误提示

**验证点**:
- ✅ 超长版本号被拒绝并显示错误提示
- ✅ 无效数据类型被正确处理

## 故障排查

### 问题1: 保存后版本号没有变化

**可能原因**:
- 前端未传递version字段
- 云函数字段投影不包含version
- 数据库schema不支持version字段

**解决方案**:
1. 检查浏览器网络请求中的payload
2. 验证云函数代码中的字段投影
3. 检查数据库schema定义

### 问题2: 控制台报错

**可能错误**:
- "version field not allowed" - 数据库schema问题
- "validation failed" - 数据格式问题

**解决方案**:
1. 更新数据库schema
2. 检查数据格式和长度限制

## 验证标准

**功能验收**:
- ✅ 版本号字段能正常保存到数据库
- ✅ 修改后的版本号能正确显示
- ✅ 数据验证功能正常工作

**性能验收**:
- ✅ 保存操作响应时间正常（< 3秒）
- ✅ 页面加载和数据显示正常

**兼容性验收**:
- ✅ 不影响其他字段的保存
- ✅ 向后兼容现有数据

## 实施完成标记

修复完成后，请在测试流程文档中标记：

- [x] 前端字段传递修复
- [x] 数据库schema更新
- [x] 云函数验证添加
- [x] 功能测试通过
- [x] 回归测试通过

**修复完成时间**: [YYYY-MM-DD HH:mm]
**测试人员**: [姓名]
**测试结果**: [通过/失败]