# 修复小程序端剧本详情图片显示问题 - 测试流程

**测试目标**: 验证小程序端剧本详情页面中的图片是否能正常显示

**修复内容**:
1. 修复`resolveImages`方法以正确处理图片对象到URL的转换
2. 修复`fetchFullImages`方法中的图片URL处理
3. 确保所有图片显示逻辑都能正确处理管理端数据结构

## 前置条件

### 数据准备
确保数据库中存在包含图片的剧本数据，图片字段格式如下：
```json
{
  "images": [
    {
      "url": "https://example.com/image1.jpg",
      "fileId": "file_id_1"
    },
    {
      "url": "https://example.com/image2.jpg",
      "fileId": "file_id_2"
    }
  ]
}
```

### 环境准备
- 小程序开发环境正常运行
- 云函数已部署最新版本
- 测试设备支持图片显示

## 测试流程

### 测试用例 1: 剧本详情轮播图显示

**目的**: 验证剧本详情页面的图片轮播功能

**步骤**:
1. 在小程序中进入剧本列表页面
2. 点击任意有图片的剧本项
3. 进入剧本详情页面

**验证点**:
- ✅ 图片轮播区域正常显示（不显示"暂无图片"）
- ✅ 轮播图可以正常滑动
- ✅ 图片加载正常，无空白或错误图标
- ✅ 轮播指示器正确显示（多张图片时）

### 测试用例 2: 全屏图片查看器

**目的**: 验证全屏图片查看器的功能

**步骤**:
1. 在剧本详情页面点击图片轮播区域
2. 打开全屏图片查看器

**验证点**:
- ✅ 全屏查看器正常打开
- ✅ 图片正常显示在全屏模式下
- ✅ 可以滑动查看多张图片
- ✅ 缩放功能正常工作
- ✅ 关闭按钮功能正常

### 测试用例 3: 图片数据格式兼容性

**目的**: 验证不同图片数据格式的兼容性

**测试场景**:
1. **对象格式图片**:
   ```json
   "images": [{"url": "https://example.com/img.jpg", "fileId": "id1"}]
   ```

2. **字符串格式图片**:
   ```json
   "images": ["https://example.com/img.jpg"]
   ```

3. **混合格式图片**:
   ```json
   "images": [
     {"url": "https://example.com/img1.jpg"},
     "https://example.com/img2.jpg"
   ]
   ```

**验证点**:
- ✅ 所有格式的图片都能正常显示
- ✅ 无效图片URL被正确过滤
- ✅ 不影响其他正常图片的显示

### 测试用例 4: 图片加载性能

**目的**: 验证图片加载性能和错误处理

**步骤**:
1. 测试大尺寸图片的加载时间
2. 测试网络较慢情况下的图片显示
3. 测试无效图片URL的处理

**验证点**:
- ✅ 图片加载时间合理（< 3秒）
- ✅ 加载失败时有适当的错误提示
- ✅ 不阻塞页面其他内容的显示

## 故障排查

### 问题1: 图片不显示，显示为空白

**可能原因**:
- 图片URL格式不正确
- resolveImages方法处理失败
- 网络问题导致图片无法加载

**解决方案**:
1. 检查浏览器控制台是否有JavaScript错误
2. 验证图片URL是否可访问
3. 检查resolveImages方法的处理逻辑

### 问题2: 轮播图无法滑动

**可能原因**:
- 图片数组为空或格式错误
- swiper组件配置问题

**解决方案**:
1. 检查script.images数组的内容
2. 验证图片URL的有效性
3. 检查swiper组件的配置

### 问题3: 全屏查看器显示异常

**可能原因**:
- viewerImages数组处理失败
- fetchFullImages方法返回错误数据

**解决方案**:
1. 检查viewerImages数组的内容
2. 验证fetchFullImages方法的处理逻辑
3. 检查全屏查看器的样式和事件绑定

## 验证标准

**功能验收**:
- ✅ 剧本详情页面图片正常显示
- ✅ 轮播功能正常工作
- ✅ 全屏查看器功能完整
- ✅ 不同数据格式兼容性良好

**性能验收**:
- ✅ 图片加载时间 < 3秒
- ✅ 页面切换流畅
- ✅ 内存使用正常

**兼容性验收**:
- ✅ 支持管理端图片数据格式
- ✅ 向后兼容旧数据格式
- ✅ 错误处理完善

## 测试记录

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 剧本详情轮播图显示 | ⏳ 待测试 | - |
| 全屏图片查看器 | ⏳ 待测试 | - |
| 图片数据格式兼容性 | ⏳ 待测试 | - |
| 图片加载性能 | ⏳ 待测试 | - |

## 修复完成标记

修复完成后，请在测试流程文档中标记：

- [x] resolveImages方法修复
- [x] fetchFullImages方法修复
- [x] 图片显示功能测试通过
- [x] 兼容性测试通过
- [x] 性能测试通过

**修复完成时间**: [YYYY-MM-DD HH:mm]
**测试人员**: [姓名]
**测试结果**: [通过/失败]