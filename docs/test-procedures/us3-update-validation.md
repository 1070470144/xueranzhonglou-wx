# 手动测试流程：US3 更新验证

**用户故事**: US3 - 统一剧本更新管理
**测试类型**: 手动验证测试
**测试目标**: 验证剧本更新过程中的数据验证和完整性保证

## 测试环境准备

### 前置条件
- [ ] 编辑页面已正确加载 (`/pages/admin/scripts/edit?id=xxx`)
- [ ] 测试剧本数据完整
- [ ] 网络连接正常

### 测试数据
- 验证数据类型:
  - 字符串字段: title, author, description
  - 枚举字段: tag (推理/娱乐)
  - 数值字段: usageCount, likes
- 边界值:
  - 最小长度: 空字符串
  - 最大长度: 超长字符串
  - 无效值: 非法枚举值

## 测试步骤

### 步骤 1: 验证必填字段检查
1. 清空标题字段
2. 清空作者字段
3. 点击保存按钮
4. **预期结果**: 显示错误信息"请输入剧本标题"和"请输入作者姓名"
5. 表单不提交，停留在当前页面

### 步骤 2: 验证字段长度限制
1. 输入超过200字符的标题
2. 输入超过100字符的作者名
3. 输入超过1000字符的描述
4. **预期结果**: 字段正确限制输入，或显示长度错误提示

### 步骤 3: 验证枚举值限制
1. 尝试设置标签为无效值（如"其他"）
2. **预期结果**: 只允许选择"推理"或"娱乐"
3. 表单验证阻止无效标签值

### 步骤 4: 验证数值字段
1. 输入负数的usageCount
2. 输入负数的likes
3. **预期结果**: 显示错误提示"必须大于等于0"或自动修正为0

### 步骤 5: 验证数据类型
1. 在数值字段中输入非数字字符
2. **预期结果**: 阻止输入或显示类型错误

### 步骤 6: 验证更新前后数据一致性
1. 记录编辑前的所有字段值
2. 修改部分字段
3. 保存后重新加载数据
4. **预期结果**: 未修改字段保持原值，修改字段正确更新

## 服务端验证测试

### 步骤 7: 验证API参数验证
1. 使用浏览器开发者工具拦截请求
2. 修改请求参数为无效值
3. **预期结果**: 服务器返回相应的验证错误信息

### 步骤 8: 验证数据库约束
1. 尝试保存违反数据库schema的数据
2. **预期结果**: 操作失败，返回适当的错误信息

## 错误处理验证

### 步骤 9: 验证网络错误处理
1. 在保存过程中断开网络
2. **预期结果**: 显示网络错误提示，提供重试选项

### 步骤 10: 验证权限错误处理
1. 使用无权限用户尝试编辑
2. **预期结果**: 显示权限错误，操作被拒绝

### 步骤 11: 验证并发修改处理
1. 同时在两个浏览器窗口编辑同一剧本
2. 先在窗口A保存修改
3. 然后在窗口B尝试保存
4. **预期结果**: 窗口B显示数据已过期或冲突提示

## 数据完整性验证

### 步骤 12: 验证事务完整性
1. 编辑包含多个关联数据的剧本
2. 在保存过程中模拟部分失败
3. **预期结果**: 要么全部成功，要么全部回滚，无中间状态

### 步骤 13: 验证审计日志
1. 完成一次成功的编辑操作
2. 检查系统日志
3. **预期结果**: 记录了编辑操作的详细信息

## 验收标准

- [ ] 必填字段正确验证
- [ ] 长度限制正确实施
- [ ] 枚举值正确限制
- [ ] 数值字段正确验证
- [ ] 数据类型正确检查
- [ ] 数据一致性得到保证
- [ ] API参数验证有效
- [ ] 数据库约束正确实施
- [ ] 错误情况正确处理
- [ ] 数据完整性得到保证
- [ ] 操作正确记录到审计日志

## 验证覆盖率

确保测试覆盖以下场景：
- ✅ 前端表单验证
- ✅ 服务端API验证
- ✅ 数据库schema验证
- ✅ 业务逻辑验证
- ✅ 错误处理验证
- ✅ 数据完整性验证

## 缺陷记录

如果发现验证问题，请记录：
- 验证类型（前端/服务端/数据库）
- 具体字段和值
- 预期行为 vs 实际行为
- 错误消息准确性
