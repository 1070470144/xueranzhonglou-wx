# 用户故事5 - 使用次数统计手动测试流程

**用户故事**: US5 - JSON复制使用统计
**测试目标**: 验证每次JSON复制时使用次数正确增加并同步到后台数据库
**优先级**: P2
**预计测试时间**: 8分钟

## 测试前准备

### 环境要求
- 小程序运行环境正常
- 数据库可正常访问和更新
- 测试剧本的初始使用次数已知

### 测试数据准备
选择一个测试剧本，记录其初始使用次数：
- 剧本ID: _______________
- 初始使用次数: _______________
- 测试时间: _______________

## 测试步骤

### 步骤1: 初始状态确认
1. 进入测试剧本的详情页面
2. 记录当前显示的使用次数
3. 确认数值正确显示

**预期结果**:
- ✅ 使用次数正确显示在界面上
- ✅ 与数据库中的值一致

### 步骤2: 单次JSON复制测试
1. 点击"复制JSON地址"按钮
2. 等待"JSON链接已复制"提示
3. 立即刷新页面或重新进入详情页
4. 检查使用次数是否增加1

**预期结果**:
- ✅ 使用次数准确增加1
- ✅ 界面显示更新后的数值
- ✅ 提示信息正确显示

### 步骤3: 多次复制测试
1. 重复步骤2的操作3-5次
2. 每次检查使用次数是否正确递增
3. 验证累计增加的次数

**预期结果**:
- ✅ 每次复制都正确增加使用次数
- ✅ 累加数值准确无误
- ✅ 无跳跃或重复计数

### 步骤4: 数据库同步验证
1. 在小程序外部访问数据库
2. 查询测试剧本的使用次数字段
3. 确认数据库中的值与界面显示一致

**预期结果**:
- ✅ 数据库中的使用次数正确更新
- ✅ 与界面显示的数值完全一致

### 步骤5: 并发测试（可选）
1. 在多个设备或浏览器同时进行JSON复制操作
2. 验证并发访问下的计数准确性

**预期结果**:
- ✅ 并发操作不会导致计数错误
- ✅ 所有操作都被正确记录

## 验收标准

- [ ] 每次JSON复制成功后，使用次数准确增加1
- [ ] 使用次数统计更新响应时间不超过1秒
- [ ] 数据库与前端显示保持完全同步
- [ ] 统计失败不影响主要JSON复制功能
- [ ] 并发访问下计数器保持一致性

## 常见问题排查

### 问题1: 使用次数不增加
**原因**: 统计逻辑执行失败或数据库更新失败
**解决**: 检查云函数日志，确认统计代码是否正常执行

### 问题2: 前端显示不更新
**原因**: API响应解析错误或前端更新逻辑问题
**解决**: 检查script-detail.vue中的响应处理代码

### 问题3: 数据库不同步
**原因**: 网络问题或数据库连接问题
**解决**: 检查云函数执行结果和数据库连接状态

## 测试记录

| 测试轮次 | 测试日期 | 测试人员 | 初始次数 | 最终次数 | 增加次数 | 结果 | 备注 |
|----------|----------|----------|----------|----------|----------|------|------|
| 1 | 2026-01-15 | 系统 | | | | | 初始测试 |

## 签核

**测试人员**: _______________
**测试日期**: _______________
**测试结果**: 通过 ☐ / 不通过 ☐