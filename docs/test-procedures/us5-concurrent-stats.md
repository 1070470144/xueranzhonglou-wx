# 用户故事5 - 并发统计手动测试流程

**用户故事**: US5 - JSON复制使用统计
**测试目标**: 验证并发访问下使用次数统计的准确性和一致性
**优先级**: P2
**预计测试时间**: 10分钟

## 测试前准备

### 环境要求
- 多个测试设备或浏览器实例
- 网络条件良好
- 测试剧本使用次数已重置为已知值

### 测试数据准备
- 测试剧本ID: _______________
- 初始使用次数: 0 (建议重置为0)
- 测试并发数: 3-5个并发操作

## 测试步骤

### 步骤1: 并发操作设置
1. 准备3-5个不同的设备/浏览器
2. 每个设备都进入同一测试剧本的详情页面
3. 确保所有设备都显示相同的初始使用次数

**预期结果**:
- ✅ 所有设备显示相同的初始使用次数
- ✅ 页面加载正常，无错误

### 步骤2: 同时触发JSON复制
1. 在所有设备上同时点击"复制JSON地址"按钮
2. 记录每个设备的操作时间和结果
3. 等待所有操作完成

**预期结果**:
- ✅ 所有设备都显示"JSON链接已复制"成功提示
- ✅ 无操作失败或错误

### 步骤3: 结果验证
1. 在一个设备上刷新页面查看最新使用次数
2. 确认使用次数等于并发操作的数量
3. 在其他设备上也刷新确认显示一致

**预期结果**:
- ✅ 使用次数准确等于并发操作数
- ✅ 所有设备显示相同的使用次数
- ✅ 无计数丢失或重复

### 步骤4: 交替操作测试
1. 设备A复制JSON
2. 立即在设备B复制JSON
3. 重复交替操作多次
4. 验证每次操作后计数都正确递增

**预期结果**:
- ✅ 交替操作下的计数准确性
- ✅ 快速连续操作的正确处理

### 步骤5: 数据库一致性检查
1. 等待一段时间确保所有更新完成
2. 检查数据库中的使用次数
3. 确认与前端显示完全一致

**预期结果**:
- ✅ 数据库值与前端显示一致
- ✅ 无延迟同步问题

## 验收标准

- [ ] 并发操作下计数器准确无误
- [ ] 所有并发请求都被正确处理
- [ ] 数据库状态与前端显示保持一致
- [ ] 无竞态条件或数据不一致问题

## 压力测试建议

### 高并发测试
- 目标: 10+并发操作
- 方法: 使用自动化脚本或多个团队成员
- 预期: 保持计数准确性

### 网络异常测试
- 目标: 网络不稳定情况下的统计
- 方法: 在弱网络环境下进行并发操作
- 预期: 要么成功要么明确失败，不产生不一致状态

## 测试记录

| 测试轮次 | 测试日期 | 测试人员 | 并发数 | 预期增加 | 实际增加 | 结果 | 备注 |
|----------|----------|----------|--------|----------|----------|------|------|
| 1 | 2026-01-15 | 系统 | 3 | 3 | | | 初始测试 |

## 签核

**测试人员**: _______________
**测试日期**: _______________
**测试结果**: 通过 ☐ / 不通过 ☐