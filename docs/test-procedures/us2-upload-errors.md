# 手动测试流程：US2 错误处理

**用户故事**: US2 - 统一剧本上传管理
**测试类型**: 手动错误处理测试
**测试目标**: 验证上传过程中的各种错误情况和用户反馈

## 测试环境准备

### 前置条件
- [ ] 剧本管理页面已加载 (`/pages/admin/scripts/list`)
- [ ] 用户已登录并具有上传权限
- [ ] 网络连接可控制（可模拟断网）

### 测试数据
- 有效文件: `valid-script.txt`
- 损坏文件: `corrupted-file.txt` (如果可能创建)
- 重复文件名: 与现有剧本同名的文件

## 测试步骤

### 步骤 1: 验证无文件上传错误
1. 不选择任何文件直接点击"上传剧本"按钮
2. **预期结果**: 显示错误提示"请先选择要上传的文件"
3. 上传按钮保持禁用状态直到选择文件

### 步骤 2: 验证文件损坏错误
1. 选择一个损坏或无法读取的文件
2. 点击"上传剧本"按钮
3. **预期结果**: 显示错误提示"文件读取失败"或类似消息
4. 文件信息保持显示，用户可以重新选择

### 步骤 3: 验证网络中断错误
1. 开始上传文件
2. 在上传过程中断开网络连接
3. **预期结果**: 显示网络错误提示
4. 提供重试选项或允许重新选择文件

### 步骤 4: 验证服务器错误
1. 上传文件时模拟服务器500错误
2. **预期结果**: 显示"服务器错误，请稍后重试"消息
3. 文件信息保持，用户可以重试上传

### 步骤 5: 验证权限错误
1. 使用无上传权限的用户账户
2. 尝试上传文件
3. **预期结果**: 显示"权限不足"错误消息

### 步骤 6: 验证重复上传处理
1. 上传一个已存在的剧本文件
2. **预期结果**: 显示"剧本已存在"提示，或自动覆盖，或要求确认

### 步骤 7: 验证云存储错误
1. 模拟云存储服务不可用的情况
2. 尝试上传文件
3. **预期结果**: 显示"存储服务暂时不可用"错误

## 错误恢复验证

### 步骤 8: 错误后的重试功能
1. 遇到错误后，点击"重试"按钮
2. **预期结果**: 重新开始上传过程
3. 之前的进度和文件选择保持

### 步骤 9: 错误后的文件重新选择
1. 遇到错误后，重新选择不同的文件
2. **预期结果**: 新文件正确替换，错误状态清除

## 用户体验验证

### 步骤 10: 错误消息清晰度
1. 检查所有错误消息
2. **预期结果**: 消息清晰易懂，包含具体的错误原因
3. 提供解决建议（如果适用）

### 步骤 11: 错误状态视觉反馈
1. 观察错误状态下的UI变化
2. **预期结果**: 错误状态有明显的视觉指示（红色边框、错误图标等）
3. 成功状态有明确的视觉反馈（绿色对勾等）

## 无兜底逻辑验证

### 步骤 12: 验证错误不被隐藏
1. 故意触发各种错误情况
2. **预期结果**: 错误被明确报告，不会被兜底逻辑隐藏
3. 系统状态保持一致，不出现部分成功的情况

## 验收标准

- [ ] 无文件选择时正确提示
- [ ] 文件损坏时正确处理
- [ ] 网络错误有适当反馈
- [ ] 服务器错误正确显示
- [ ] 权限错误正确处理
- [ ] 重复上传有明确处理
- [ ] 云存储错误正确反馈
- [ ] 错误后可以重试
- [ ] 错误消息清晰易懂
- [ ] 错误状态有视觉反馈
- [ ] 无兜底逻辑，错误不被隐藏

## 错误代码映射

确保以下错误情况有对应的用户友好消息：

| 错误类型 | HTTP状态码 | 用户消息 |
|----------|------------|----------|
| 文件过大 | 413 | 文件大小超过10MB限制 |
| 格式不支持 | 400 | 不支持的文件格式 |
| 权限不足 | 403 | 没有上传权限 |
| 服务器错误 | 500 | 服务器暂时不可用，请稍后重试 |
| 网络错误 | - | 网络连接失败，请检查网络后重试 |
| 文件损坏 | 400 | 文件内容无法读取 |

## 缺陷记录

如果发现任何不符合预期的行为，请记录：
- 错误类型
- 错误消息
- 用户操作步骤
- 是否有兜底逻辑隐藏错误
- 建议的改进方案
