# xueran-admin 项目宪章
<!--
Sync Impact Report
- Version change: unknown → 1.0.0
- Modified principles:
  - 新增: 使用 HBuilderX 云对象为首选运行时 (非可选)
  - 新增: 尽量避免云函数，明确云函数仅为例外方案
  - 新增: 文档语言必须为中文
  - 新增: 文件上传与数据一致性规则
  - 新增: 测试与可观测性要求
- Added sections: 技术约束; 开发工作流（中文文档、PR/审查流程）
- Removed sections: none
- Templates updated:
  - ✅ .specify/templates/plan-template.md (Constitution Check 已更新)
  - ✅ .specify/templates/spec-template.md (添加文档语言要求)
  - ⚠ .specify/templates/tasks-template.md (建议人工确认是否需添加上传/文件任务模板)
  - ⚠ 其它命令/模板：请人工检视 `.specify/templates/*` 内的命令与示例，确保中文与云对象优先原则一致
- Follow-up TODOs:
  - TODO(RATIFICATION_DATE): 填写宪章首次通过日期（若已知）
  - 验证并在必要时将 `listScripts` / `getScript` 等模板示例与云对象约束对齐（服务器端 vs 前端职责）
-->

## 核心原则

### 使用 HBuilderX 云对象为首选运行时（强制）
所有服务器端交互优先使用 HBuilderX 提供的云对象（云对象、云存储、云数据库等）。在平台支持的能力范围内，禁止将日常的 CRUD、文件下载/预览、上传回调等交给独立云函数处理。仅当云对象无法实现某项功能且经过审查批准时，方可引入云函数（需在 PR 中说明技术不可行性与回退计划）。
理由：统一运行时与权限边界可以简化部署、日志与调试流程，降低序列化/反序列化带来的兼容问题（例如 RegExp/flags 问题），同时提升开发效率。

### 尽量避免云函数（仅作例外）
云函数仅在下列情形允许：1) 平台云对象无法实现（明确记录不可行原因）；2) 安全或隔离边界要求将逻辑独立部署；3) 性能/计费模型在云函数中更优。任何使用云函数的变更必须在 PR 描述中给出理由、替代方案与回退计划，并由至少两位维护者批准。
理由：云函数增加调试与版本同步复杂度，且在本项目中引发了序列化与 H5 端兼容问题（见问题记录）。

### 文档与沟通一律中文（必需）
项目内的计划、规范、任务、快速上手文档、代码注释（非第三方接口说明除外）应使用中文编写。若需对外发布英文文档，应在中文文档准备完毕后单独维护译本并标注来源。
理由：团队协作效率与长期可维护性依赖一致的语言标准，中文为首选以减少歧义。

### 文件上传与数据一致性（必需）
涉及文件/图片的功能必须：
- 在前端与后端都做字段校验并兼容常见返回格式（例如 `fileId` / `fileID` / `url`）；  
- 在保存流程中明确将上传返回的 fileID 写入数据库，并在数据库里保存可稳定访问的元信息（如 fileId/url、文件名、mime）；  
- 在读取流程中若 `images` 为空且 `jsonFile` 指向可访问的 JSON 源，需从该 JSON 中提取封面/预览图或在云对象层做合并后返回；  
- 提交/创建接口必须记录操作日志并提供可回溯的错误信息，以便在 H5 层快速定位问题。
理由：保证前端展示与后台数据一致，避免因上传字段命名/序列化差异导致缺图或解析错误。

### 测试与可观测性（必需）
- P1 用户旅程必须在实现前定义独立可运行的测试用例（契约/集成/端到端）；测试用例应在 CI 中可被执行。  
- 关键操作（文件上传、删除、第三方调用）必须有日志与错误告警点，且在计划阶段定义监控/报警阈值。

## 技术约束
本项目首选技术栈与约束：
- 运行时/云能力：HBuilderX 云对象、uniCloud 云存储/数据库，优先使用云对象 API；尽量避免云函数。  
- 前端：uni-app / Vue（保持现有架构），H5 调试需兼顾 uni-h5 的序列化特性。  
- 文档：中文为准；规范模板（`.specify/templates`）中的 Plan/Spec/Tasks 必须体现中文与云对象优先约束。  
- 测试：契约测试 + 集成测试为首选，单元测试为基础。CI 必须能运行核心测试。

## 开发工作流
- 所有变更通过 Pull Request（或团队使用的代码评审流程）进行；PR 描述必须包含：变更目的、如何验证、是否影响运行时选择（云对象 vs 云函数）、回退计划。  
- 任何将云函数引入项目的 PR 必须提供书面不可行性说明并至少获得两位维护者批准。  
- 文档、计划、任务和快速上手均以中文撰写；任务模板应列明哪些步骤必须包含上传/文件验证。  
- 代码风格、Lint、格式化工具在项目初期明确并统一配置；CI 在合并前必须通过 lint 与关键测试。

## Governance
宪章为本项目的高阶约束；任何对宪章的修订必须：
1. 提交修订的 PR，列出修订要点与兼容性影响（若有）；  
2. 须由至少两位维护者审阅并批准；若涉及跨团队影响，应通知相关负责人；  
3. 修订须包含迁移计划（如影响接口或运行时约束）；  
4. 修订通过后，更新 `.specify/memory/constitution.md` 的 `Last Amended` 与 `Version` 字段，并在 Sync Impact Report 中列出受影响的模板与后续 TODO。

**Version**: 1.0.0 | **Ratified**: TODO(RATIFICATION_DATE): 填写宪章首次通过日期 | **Last Amended**: 2026-01-13
