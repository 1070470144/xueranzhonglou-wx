# xueran-admin 项目宪章
<!--
Sync Impact Report
- Version change: 1.3.0 → 1.4.0
- Modified principles:
  - 新增: 回复与沟通规范（强制）
- Added sections: none
- Removed sections: none
- Templates updated:
  - ⚠ .specify/templates/plan-template.md (无需更新)
  - ⚠ .specify/templates/spec-template.md (无需更新)
  - ⚠ .specify/templates/tasks-template.md (无需更新)
  - ⚠ 其它命令/模板：无需更新
- Follow-up TODOs:
  - TODO(RATIFICATION_DATE): 填写宪章首次通过日期（若已知）
-->

## 核心原则

### 使用 HBuilderX 云对象为首选运行时（强制）
所有服务器端交互优先使用 HBuilderX 提供的云对象（云对象、云存储、云数据库等）。在平台支持的能力范围内，禁止将日常的 CRUD、文件下载/预览、上传回调等交给独立云函数处理。仅当云对象无法实现某项功能且经过审查批准时，方可引入云函数（需在 PR 中说明技术不可行性与回退计划）。
理由：统一运行时与权限边界可以简化部署、日志与调试流程，降低序列化/反序列化带来的兼容问题（例如 RegExp/flags 问题），同时提升开发效率。

### 尽量避免云函数（仅作例外）
云函数仅在下列情形允许：1) 平台云对象无法实现（明确记录不可行原因）；2) 安全或隔离边界要求将逻辑独立部署；3) 性能/计费模型在云函数中更优。任何使用云函数的变更必须在 PR 描述中给出理由、替代方案与回退计划，并由至少两位维护者批准。
理由：云函数增加调试与版本同步复杂度，且在本项目中引发了序列化与 H5 端兼容问题（见问题记录）。

### 文档与沟通一律中文（必需）
项目内的计划、规范、任务、快速上手文档、代码注释（非第三方接口说明除外）应使用中文编写。若需对外发布英文文档，应在中文文档准备完毕后单独维护译本并标注来源。
理由：团队协作效率与长期可维护性依赖一致的语言标准，中文为首选以减少歧义。

### 回复与沟通规范（强制）
所有文档、评论、回复、评审意见和团队沟通必须使用中文。包括但不限于：代码评审意见、问题讨论、Pull Request 描述、提交信息、会议记录等。
理由：确保团队沟通的一致性和高效性，避免语言混用导致的理解偏差和沟通障碍。

### 文件上传与数据一致性（必需）
涉及文件/图片的功能必须：
- 在前端与后端都做字段校验并兼容常见返回格式（例如 `fileId` / `fileID` / `url`）；  
- 在保存流程中明确将上传返回的 fileID 写入数据库，并在数据库里保存可稳定访问的元信息（如 fileId/url、文件名、mime）；  
- 在读取流程中若 `images` 为空且 `jsonFile` 指向可访问的 JSON 源，需从该 JSON 中提取封面/预览图或在云对象层做合并后返回；  
- 提交/创建接口必须记录操作日志并提供可回溯的错误信息，以便在 H5 层快速定位问题。
理由：保证前端展示与后台数据一致，避免因上传字段命名/序列化差异导致缺图或解析错误。

### 测试规范（必需）
测试只需检查代码的完整性，并给出详细的测试流程。开发者将按照提供的测试流程手动测试，并将测试结果反馈。重点关注功能完整性而非自动化测试覆盖。
理由：简化测试流程，提高开发效率，重点验证核心功能完整性而非追求全面自动化测试覆盖。

### 代码编写规范（强制）
编写代码前必须先定义好统一的接口和相应的规范，且禁止使用保底、回退等类似兜底逻辑。在此基础上如果有问题，请以修复为主而非绕过或妥协。
理由：确保代码质量与架构一致性，避免临时解决方案积累导致的技术债务，保持系统的长期可维护性。

### Git 工作流规范（强制）
在进行任何代码修改前，必须先提交当前分支的所有变更。禁止创建新的功能分支，所有开发工作在当前分支上进行。提交记录必须使用中文编写，并清晰描述变更内容。
理由：简化分支管理流程，避免分支合并冲突，确保变更记录的可追溯性和团队协作的一致性。

## 技术约束
本项目首选技术栈与约束：
- 运行时/云能力：HBuilderX 云对象、uniCloud 云存储/数据库，优先使用云对象 API；尽量避免云函数。  
- 前端：uni-app / Vue（保持现有架构），H5 调试需兼顾 uni-h5 的序列化特性。  
- 文档：中文为准；规范模板（`.specify/templates`）中的 Plan/Spec/Tasks 必须体现中文与云对象优先约束。  
- 测试：契约测试 + 集成测试为首选，单元测试为基础。CI 必须能运行核心测试。

## 开发工作流
- 在进行任何代码修改前，必须先提交当前分支的所有变更到本地仓库。
- 所有开发工作在当前分支上进行，禁止创建新的功能分支。
- 提交记录必须使用中文编写，清晰描述变更内容和目的。
- 代码变更通过团队内部评审流程进行；评审描述必须包含：变更目的、如何验证、是否影响运行时选择（云对象 vs 云函数）、回退计划。
- 任何将云函数引入项目的变更必须提供书面不可行性说明并至少获得两位维护者批准。
- 文档、计划、任务和快速上手均以中文撰写；任务模板应列明哪些步骤必须包含上传/文件验证。
- 代码风格、Lint、格式化工具在项目初期明确并统一配置；CI 在合并前必须通过 lint 与关键测试。

## Governance
宪章为本项目的高阶约束；任何对宪章的修订必须：
1. 提交修订的 PR，列出修订要点与兼容性影响（若有）；  
2. 须由至少两位维护者审阅并批准；若涉及跨团队影响，应通知相关负责人；  
3. 修订须包含迁移计划（如影响接口或运行时约束）；  
4. 修订通过后，更新 `.specify/memory/constitution.md` 的 `Last Amended` 与 `Version` 字段，并在 Sync Impact Report 中列出受影响的模板与后续 TODO。

**Version**: 1.4.0 | **Ratified**: TODO(RATIFICATION_DATE): 填写宪章首次通过日期 | **Last Amended**: 2026-01-14
